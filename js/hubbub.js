var Hubbub=function(){"use strict";function t(t,n){var a=t.getAttribute(d).match(/\/(\w+)\/?$/)[1];if(f.has(a))n(t,f.get(a),a);else{var r;r=h?"fixtures/"+a+".json":l+"gists/"+a+"/comments",s({url:r,dataType:"json"},function(r){e(r,a,t,n)},function(e){t.innerHTML=t.innerHTML+"<small>Error fetching Comments</small>"})}}function e(t,e,n,a){var r={url:l+"markdown",reqDataType:"json",type:"POST"},u=String.fromCharCode(12433),i=t.reduce(function(t,e){return t+e.body+"\r\n\r\n"+u+"\r\n\r\n"},"");r.data={text:i},s(r,function(r){var i=r.split("<p>"+u+"</p>");i.forEach(function(e,n){t[n]&&(t[n].html_body=e.trim())}),f.set(e,t),a(n,t)})}function n(t,e){var n=document.createElement("h3");n.setAttribute("class","heading");var r=document.createElement("a");r.setAttribute("href",t.getAttribute(d)),r.textContent="Comments ("+e.length+")",n.appendChild(r),t.appendChild(n),e.forEach(function(e){t.appendChild(a(t,e))})}function a(t,e){var n=document.createElement("div");n.setAttribute("class",p.container),n.appendChild(o(e.user));var a=document.createElement("div");return a.setAttribute("class",p.content),a.appendChild(r(t,e)),a.appendChild(i(e)),n.appendChild(a),n}function r(t,e){var n=document.createElement("div");n.setAttribute("class",p.header);var a=document.createElement("a");a.setAttribute("class",p.username),a.setAttribute("href",e.user.html_url),a.innerHTML="<b>"+e.user.login+"</b>";var r=t.getAttribute(d);r=r+"#comment-"+e.id;var i=document.createElement("a");return i.setAttribute("class",p.permalink),i.setAttribute("href",r),i.textContent="commented",n.appendChild(a),n.appendChild(i),n.appendChild(u(e.created_at)),n}function u(t){var e=Date.now()-new Date(t).getTime(),n=document.createElement("time");n.setAttribute("class",p.timestamp),n.setAttribute("datetime",t),n.setAttribute("title",t),e=Math.round(e/1e3);var a;if(e<3600)a=Math.round(e/60)+" minutes ago";else if(e<86400){var r=Math.round(e/3600);a=1===r?"an hour ago":r+" hours ago"}else{var u=Math.round(e/86400);a=1===u?"yesterday":u+" days ago"}return n.textContent=a,n}function i(t){var e=document.createElement("div");return e.setAttribute("class",p.commentBody),e.innerHTML=t.html_body,e}function s(t,e,n){var a=new XMLHttpRequest;t.type=t.type||"GET",a.addEventListener("readystatechange",function(r){if(4===a.readyState&&200===a.status){var u;u="json"===t.dataType?JSON.parse(r.target.responseText):r.target.responseText,e(u,r)}else 4===a.readyState&&n&&n(r)}),a.open(t.type,t.url,!0),"json"===t.reqDataType?(a.setRequestHeader("Content-type","application/json"),a.send(JSON.stringify(t.data))):a.send(t.data)}function o(t){var e=document.createElement("a");e.setAttribute("href",t.html_url),e.setAttribute("class",p.avatarLink);var n=document.createElement("img");return n.setAttribute("class",p.avatar),n.setAttribute("src",t.avatar_url),n.setAttribute("width",48),n.setAttribute("height",48),e.appendChild(n),e}if([].forEach&&window.XMLHttpRequest){var c="hubbub",d="data-gist-url",l="https://api.github.com/",m=document.querySelectorAll("."+c),b={},h=!1,p={avatar:"hubbub-avatar",avatarLink:"hubbub-avatar-link",header:"hubbub-header",username:"hubbub-username",commentBody:"hubbub-comment-body",timestamp:"hubbub-timestamp",permalink:"hubbub-permalink",content:"hubbub-content",container:"hubbub-container"},f=function(){var t="hubbub-",e=36e5;return{has:function(e){return null!==localStorage.getItem(t+e)},get:function(n){var a=JSON.parse(localStorage.getItem(t+n));return null!==a&&Date.now()-a.createdAt>e&&localStorage.removeItem(t+n),a.comments},set:function(e,n){var a={comments:n,createdAt:Date.now()};localStorage.setItem(t+e,JSON.stringify(a))}}}();return[].forEach.call(m,function(e){t(e,n)}),b.appendWidget=function(e,a){var r=document.createElement("div");r.setAttribute("class",c),r.setAttribute(d,a),e.appendChild(r),t(r,n)},b.css=p,b}}();
//# sourceMappingURL=hubbub.js.map
